{
  "version": 3,
  "sources": ["../../../lib/component/omni-assist/omni-assist-drag-controller.ts"],
  "sourcesContent": ["import { type ReactiveController } from 'lit';\nimport { type OmniAssistChatCircle } from './omni-assist-chat-circle.js';\nimport { type OmniAssistWithPlugins } from './omni-assist-with-plugins.js';\n\ntype Corner = 'TL' | 'BL' | 'TR' | 'BR';\n\nexport class OmniAssistDragController implements ReactiveController {\n  #originalBodyStyle: string;\n  #chatCircleWidth: number = 56;\n  #chatCircleHeight: number = 56;\n  #dragging = false;\n  #startX = 0;\n  #startY = 0;\n  #position: {\n    left: number;\n    top: number;\n    offsetX: number;\n    offsetY: number;\n  } = { left: 0, top: 0, offsetX: 0, offsetY: 0 };\n\n  corner: Corner = 'BR';\n  hEdgeOffset: number = 30;\n  vEdgeOffset: number = 20;\n\n  constructor(\n    private host: OmniAssistChatCircle | OmniAssistWithPlugins,\n    public cornerGravity: boolean = true,\n    public offsetLeft: number = 40\n  ) {\n    this.host.addController(this);\n  }\n\n  hostConnected() {\n    this.setPosition();\n    window.addEventListener('resize', this.setPosition);\n    this.host.addEventListener('pointerdown', this.#handlePointerDown);\n  }\n\n  #cornerToCoordinates = (): Record<Corner, { left: number; top: number }> => {\n    return {\n      TL: {\n        left: this.offsetLeft,\n        top: this.vEdgeOffset\n      },\n      TR: {\n        left: window.innerWidth - this.#chatCircleWidth - this.hEdgeOffset,\n        top: this.vEdgeOffset\n      },\n      BL: {\n        left: this.offsetLeft,\n        top: window.innerHeight - this.#chatCircleHeight - this.vEdgeOffset\n      },\n      BR: {\n        left: window.innerWidth - this.#chatCircleWidth - this.hEdgeOffset,\n        top: window.innerHeight - this.#chatCircleHeight - this.vEdgeOffset\n      }\n    };\n  };\n\n  setPosition = (e = null, animate = false) => {\n    if (animate) {\n      this.host.animate(\n        [\n          { top: `${this.#position.top}px`, left: `${this.#position.left}px` },\n          {\n            top: this.#cornerToCoordinates()[this.corner].top + 'px',\n            left: this.#cornerToCoordinates()[this.corner].left + 'px'\n          }\n        ],\n        { duration: 300, easing: 'cubic-bezier(0.42, 0, 0.58, 1)' }\n      );\n    }\n    this.#position.left = this.#cornerToCoordinates()[this.corner].left;\n    this.#position.top = this.#cornerToCoordinates()[this.corner].top;\n    this.host.style.left = `${Math.round(this.#position.left)}px`;\n    this.host.style.top = `${Math.round(this.#position.top)}px`;\n  };\n\n  public get tooltipPlace() {\n    const positionToPlace = {\n      TL: 'right',\n      TR: 'left',\n      BL: 'right',\n      BR: 'left'\n    };\n    return positionToPlace[this.corner] as 'right' | 'left';\n  }\n\n  #handlePointerDown = (e: PointerEvent) => {\n    this.#dragging = false;\n    this.#startX = e.clientX;\n    this.#startY = e.clientY;\n    const { left, top } = this.host.getBoundingClientRect();\n    const offsetX = e.clientX - left;\n    const offsetY = e.clientY - top;\n    this.#position = {\n      left,\n      top,\n      offsetX,\n      offsetY\n    };\n\n    document.addEventListener('pointermove', this.#handlePointerMove);\n    document.addEventListener('mouseleave', this.#handlePointerUp);\n    document.addEventListener('mouseout', this.#handlePointerUp);\n    document.addEventListener('mouseup', this.#handlePointerUp);\n    document.addEventListener('pointerup', this.#handlePointerUp);\n    document.addEventListener('pointerleave', this.#handlePointerUp);\n    document.addEventListener('pointerout', this.#handlePointerUp);\n    document.addEventListener('pointercancel', this.#handlePointerUp);\n    this.#originalBodyStyle = document.body.style.cssText;\n  };\n\n  #handlePointerMove = (e: PointerEvent) => {\n    e.preventDefault();\n    if (Math.abs(e.clientX - this.#startX) > 5 || Math.abs(e.clientY - this.#startY) > 5) {\n      this.#dragging = true;\n      this.host.dragging = true;\n    }\n    document.body.style.cursor = 'grabbing';\n    document.body.style.userSelect = 'none';\n    document.body.style['-webkit-user-select'] = 'none'; //\n    const { clientX, clientY } = e;\n    const { offsetX, offsetY } = this.#position;\n    const left = clientX - offsetX;\n    const top = clientY - offsetY;\n    this.#position.left = left;\n    this.#position.top = top;\n    this.host.style.left = `${Math.round(this.#position.left)}px`;\n    this.host.style.top = `${Math.round(top)}px`;\n    const { innerWidth, innerHeight } = self;\n    if (left < innerWidth / 2 && top < innerHeight / 2) {\n      this.corner = 'TL';\n    } else if (left < innerWidth / 2 && top >= innerHeight / 2) {\n      this.corner = 'BL';\n    } else if (left >= innerWidth / 2 && top < innerHeight / 2) {\n      this.corner = 'TR';\n    } else {\n      this.corner = 'BR';\n    }\n    this.host.requestUpdate();\n  };\n\n  #handlePointerUp = async (e: MouseEvent) => {\n    document.removeEventListener('pointermove', this.#handlePointerMove);\n    document.removeEventListener('mouseleave', this.#handlePointerUp);\n    document.removeEventListener('mouseout', this.#handlePointerUp);\n    document.removeEventListener('mouseup', this.#handlePointerUp);\n    document.removeEventListener('pointerup', this.#handlePointerUp);\n    document.removeEventListener('pointerleave', this.#handlePointerUp);\n    document.removeEventListener('pointerout', this.#handlePointerUp);\n    document.removeEventListener('pointercancel', this.#handlePointerUp);\n    document.body.style.cssText = this.#originalBodyStyle;\n    this.host.dragging = false;\n    if (this.cornerGravity && this.#dragging) {\n      await this.host.animate(\n        [\n          { top: `${this.#position.top}px`, left: `${this.#position.left}px` },\n          {\n            top: this.#cornerToCoordinates()[this.corner].top + 'px',\n            left: this.#cornerToCoordinates()[this.corner].left + 'px'\n          }\n        ],\n        { duration: 350, easing: 'cubic-bezier(0.42, 0, 0.58, 1)' }\n      ).finished;\n      this.setPosition();\n    }\n    const isClick = !this.#dragging;\n    this.#dragging = false;\n    // 'omni-dragend' to not conflict with native dragend events\n    this.host.dispatchNewEvent('omni-dragend', { detail: { corner: this.corner, isClick: isClick } });\n  };\n\n  hostDisconnected() {\n    window.removeEventListener('resize', this.setPosition);\n    this.host.removeEventListener('pointerdown', this.#handlePointerDown);\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
