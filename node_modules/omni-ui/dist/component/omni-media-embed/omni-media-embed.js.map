{
  "version": 3,
  "sources": ["../../../lib/component/omni-media-embed/omni-media-embed.ts"],
  "sourcesContent": ["import { html, nothing, type TemplateResult } from 'lit';\nimport { unsafeHTML } from 'lit-html/directives/unsafe-html.js';\nimport { property, state } from 'lit/decorators.js';\nimport DOMPurify from 'dompurify';\nimport { OmniElement } from '../../omni-element.js';\n\nimport {css} from 'lit';\nconst styles = css`:host{--aspect-ratio: 16/9}iframe,.skeleton{aspect-ratio:var(--aspect-ratio);max-height:100%}.skeleton{width:100%}`\n\n\ntype MediaType = '_youtube' | '_vimeo' | '_spotify' | '_soundcloud';\n\n/**\n * A media player to embed specific sources via the [oEmbed](https://oembed.com/) specification.\n *\n * To include within your project `import { OmniMediaEmbed } from 'omni-ui';`\n *\n * **Content Security Policy and OmniMediaEmbed**\n *\n * The OmniMediaEmbed component uses the `<iframe>` tag to embed content from\n * YouTube, Vimeo, Open Spotify, and SoundCloud. If you are using a Content Security\n * Policy (CSP) in your application, you will need to add the following to your\n * CSP:\n * ```\n * connect-src https://www.youtube.com/oembed https://vimeo.com/api/oembed.json\n * https://soundcloud.com/oembed https://open.spotify.com/oembed;\n * frame-src https://www.youtube.com https://player.vimeo.com\n * https://open.spotify.com https://w.soundcloud.com;\n * ```\n *\n * **Rollup Configuration**\n *\n * You may encounter issues with DOMPurify when bundling code that imports OmniMediaEmbed.\n * Set exportConditions to `'module'` in your nodeResolve plugin to ensure that the\n * correct distribution of DOMPurify is used.\n *\n * In your rollup.config.mjs:\n *\n * ```js\n * {\n *   ...\n *   plugins: [\n *     nodeResolve({ exportConditions: ['module'] })\n *   ]\n * }\n * ```\n *\n * **HTTP Referrer-Policy**\n *\n * If you encounter issues with youtube embeds on a live server, add the following meta\n * tag to your index.html `<meta name=\"referrer\" content=\"origin-when-cross-origin\" />`\n *\n * @tagname omni-media-embed\n * @cssprop [--aspect-ratio=16/9] - specify the aspect ratio for the containing element host and skeleton\n */\nexport class OmniMediaEmbed extends OmniElement {\n  static get styles() {\n    return [...super.styles, styles];\n  }\n\n  @state() private _mediaType: MediaType;\n  @state() private _loading: boolean = true;\n  @state() private _noContent: boolean = false;\n  private _youtube: TemplateResult | typeof nothing;\n  private _vimeo: TemplateResult | typeof nothing;\n  private _soundcloud: TemplateResult | typeof nothing;\n  private _spotify: TemplateResult | typeof nothing;\n  /** a valid youtube, vimeo, spotify, or soundcloud url */\n  @property({ type: String }) src: string;\n\n  willUpdate(changed: Map<string, unknown>) {\n    if (changed.has('src')) {\n      if (this.src.includes('youtube') || this.src.includes('youtu.be')) {\n        this._loading = true;\n        this.#fetchEmbed('https://www.youtube.com/oembed', '_youtube');\n        return;\n      }\n\n      if (this.src.includes('vimeo')) {\n        this._loading = true;\n        this.#fetchEmbed('https://vimeo.com/api/oembed.json', '_vimeo');\n        return;\n      }\n      if (this.src.includes('spotify')) {\n        this._loading = true;\n        this.#fetchEmbed('https://open.spotify.com/oembed', '_spotify', false);\n        return;\n      }\n      if (this.src.includes('soundcloud')) {\n        this._loading = true;\n        this.#fetchEmbed('https://soundcloud.com/oembed', '_soundcloud');\n        return;\n      }\n      this._noContent = true;\n    }\n  }\n\n  #fetchEmbed(oembedUrl: string, mediaType: MediaType, replaceHeight: boolean = true) {\n    fetch(`${oembedUrl}?url=${encodeURIComponent(this.src)}`)\n      .then(resp => resp.json())\n      .then(resp => {\n        let snippet = resp.html.replace(/width=\"\\d+\"/, 'width=\"100%\"');\n        if (replaceHeight) {\n          snippet = snippet.replace(/height=\"\\d+\"/, '');\n        }\n        const cleanSnippet = DOMPurify.sanitize(snippet, {\n          ADD_TAGS: ['iframe'],\n          ADD_ATTR: ['allow', 'allowfullscreen', 'frameborder', 'scrolling']\n        });\n        this[mediaType] = html`${unsafeHTML(cleanSnippet)}`;\n        this._mediaType = mediaType;\n        this._loading = false;\n      })\n      .catch(() => {\n        this[mediaType] = nothing;\n        this._mediaType = mediaType;\n        this._loading = false;\n      });\n  }\n\n  render() {\n    if (this._noContent) return nothing;\n    return !this._loading\n      ? this[this._mediaType] ?? nothing\n      : html`<omni-style><div class=\"skeleton\"></div></omni-style>`;\n  }\n}\n\nOmniElement.register('omni-media-embed', OmniMediaEmbed);\n"],
  "mappings": ";;;;;;;;;;;AAAA,SAAS,MAAM,eAAoC;AACnD,SAAS,kBAAkB;AAC3B,SAAS,UAAU,aAAa;AAChC,OAAO,eAAe;AACtB,SAAS,mBAAmB;AAE5B,SAAQ,WAAU;AAClB,MAAM,SAAS;AAgDR,MAAM,uBAAuB,YAAY;AAAA,EAAzC;AAAA;AAMI,SAAQ,WAAoB;AAC5B,SAAQ,aAAsB;AAAA;AAAA,EANvC,WAAW,SAAS;AAClB,WAAO,CAAC,GAAG,MAAM,QAAQ,MAAM;AAAA,EACjC;AAAA,EAYA,WAAW,SAA+B;AACxC,QAAI,QAAQ,IAAI,KAAK,GAAG;AACtB,UAAI,KAAK,IAAI,SAAS,SAAS,KAAK,KAAK,IAAI,SAAS,UAAU,GAAG;AACjE,aAAK,WAAW;AAChB,aAAK,YAAY,kCAAkC,UAAU;AAC7D;AAAA,MACF;AAEA,UAAI,KAAK,IAAI,SAAS,OAAO,GAAG;AAC9B,aAAK,WAAW;AAChB,aAAK,YAAY,qCAAqC,QAAQ;AAC9D;AAAA,MACF;AACA,UAAI,KAAK,IAAI,SAAS,SAAS,GAAG;AAChC,aAAK,WAAW;AAChB,aAAK,YAAY,mCAAmC,YAAY,KAAK;AACrE;AAAA,MACF;AACA,UAAI,KAAK,IAAI,SAAS,YAAY,GAAG;AACnC,aAAK,WAAW;AAChB,aAAK,YAAY,iCAAiC,aAAa;AAC/D;AAAA,MACF;AACA,WAAK,aAAa;AAAA,IACpB;AAAA,EACF;AAAA,EAEA,YAAY,WAAmB,WAAsB,gBAAyB,MAAM;AAClF,UAAM,GAAG,SAAS,QAAQ,mBAAmB,KAAK,GAAG,CAAC,EAAE,EACrD,KAAK,UAAQ,KAAK,KAAK,CAAC,EACxB,KAAK,UAAQ;AACZ,UAAI,UAAU,KAAK,KAAK,QAAQ,eAAe,cAAc;AAC7D,UAAI,eAAe;AACjB,kBAAU,QAAQ,QAAQ,gBAAgB,EAAE;AAAA,MAC9C;AACA,YAAM,eAAe,UAAU,SAAS,SAAS;AAAA,QAC/C,UAAU,CAAC,QAAQ;AAAA,QACnB,UAAU,CAAC,SAAS,mBAAmB,eAAe,WAAW;AAAA,MACnE,CAAC;AACD,WAAK,SAAS,IAAI,OAAO,WAAW,YAAY,CAAC;AACjD,WAAK,aAAa;AAClB,WAAK,WAAW;AAAA,IAClB,CAAC,EACA,MAAM,MAAM;AACX,WAAK,SAAS,IAAI;AAClB,WAAK,aAAa;AAClB,WAAK,WAAW;AAAA,IAClB,CAAC;AAAA,EACL;AAAA,EAEA,SAAS;AACP,QAAI,KAAK;AAAY,aAAO;AAC5B,WAAO,CAAC,KAAK,WACT,KAAK,KAAK,UAAU,KAAK,UACzB;AAAA,EACN;AACF;AAlEmB;AAAA,EAAhB,MAAM;AAAA,GALI,eAKM;AACA;AAAA,EAAhB,MAAM;AAAA,GANI,eAMM;AACA;AAAA,EAAhB,MAAM;AAAA,GAPI,eAOM;AAMW;AAAA,EAA3B,SAAS,EAAE,MAAM,OAAO,CAAC;AAAA,GAbf,eAaiB;AA4D9B,YAAY,SAAS,oBAAoB,cAAc;",
  "names": []
}
